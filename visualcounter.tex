\usemodule[documentation]
\usemodule[visualcounter]

\definevisualcounter
  [section]
  [countdown]
  [n={\somenamedheadnumber{section}{current}},
   last={\somenamedheadnumber{section}{last}},
   text={\headnumber[section]},
  ]
  
\setuphead[numbercommand=\visualsection, alternative=inmargin]

\def\visualsection#1{\smash{\framed[location=middle,frame=off]{\usevisualcounter[text=#1]{section}}}}

\startbuffer[visual]
\definevisualcounter
  [visualitem]
  [scratchmarks]
  [
    counter=\currentitemgroupcounter,
    width=1.5bp,
    height=1.2ExHeight,
    distance=3bp,
  ]

\definesymbol[visual][\usevisualcounter{visualitem}]
\stopbuffer

\startbuffer[page]
\definevisualcounter
  [visualpage]
  [mayanumbers]
  [
    counter=userpage,
    maxwidth=\textwidth,
  ]

\stopbuffer

\startbuffer[pagenumber]
\setupfootertexts[\usevisualcounter{visualpage}]
\stopbuffer


\getbuffer[visual,page,pagenumber]

\startbuffer[palette]
% Color pallete from
% http://www.colourlovers.com/palette/126030/Cruel_Water_at_Night
\definecolor[deepink]  [h=030C22]
\definecolor[inkyblue] [h=20293F]
\definecolor[dustyblue][h=A9B0B3]

\definepalet
   [water-at-night]
   [past=deepink,
    current=inkyblue,
    future=dustyblue]
\stopbuffer

\getbuffer[palette]

\starttext


\title {The \command{visualcounter} module \\ Aditya Mahajan}

\starttyping
\usemodule[visualcounter]
\stoptyping

\startitemize[visual, broad, packed, columns, two]
  \item Find \TEX\ documents to be too boring?
  \item Voil√†, the \command{visualcounter} module!
  \item Make your presentations stand out.
  \item Turn any counter into a picture.
\stopitemize

The above effect was achieved by first defining a \command{visualitem} counter
and a symbol \command{visual} that uses that counter:

\typebuffer[visual]

and then using the symbol \command{visual} in an itemization:

\starttyping
\startitemize[visual, ...]
    \item ...
    \item ...
    ...
\stopitemize
\stoptyping

Notice the counter used for page numbering? That was achieved by first defining
a \command{visualpage} counter:

\typebuffer[page]

and setting it as the footer text:

\typebuffer[pagenumber]

The above examples show the basic usage of the modules. The module provides two
commands: \type{\definevisualcounter} to define a visual counter

\starttyping
\definevisualcounter
    [...]     % [[\comment{name of the counter}]]
    [...]     % [[\comment{optional name of the parent counter} ]]
    [
     ...=..., % [[\comment{key-value settings} ]]
    ]
\stoptyping

and \type{\usevisualcounter} to use an already defined counter

\starttyping
\usevisualcounter
  [...=...] % [[\comment{key-value settings}]]
  {...}     % [[\comment{name of the counter}]]
\stoptyping

<<<<<<< Updated upstream
\subject {So, how do I use this?}

Visual counters are defined and used in two ways:
\startitemize[visual, broad, joinedup]
  \item Using a low level interface that explicitly sets the current values of
    the counter, last count, the \METAPOST\ graphic that draws the counter, and
    the color palette. 
  \item Using higher-level interfaces built on top of the low-level interface
    that allows you to specify a \emph{structure counter} like those used for
    page numbering, itemizations, descriptions, etc.
\stopitemize

\subsubject {The low-level interface}

To begin with, lets not worry about how to define \METAPOST\ graphics that draw
the counter. The module provides a predefined set of \command{visualcounter}s,
and, for now, we'll just use those: the \command{scratchmarks}  counter. Details
on defining new counters is in \in{Section}[sec:new-counters].

\startbuffer[scratchmarks]
\usevisualcounter[n=6, last=12]{scratchmarks}
\stopbuffer

Suppose that I want to show that I am on page 6 out of 12 pages. We may visually
show this as

\midaligned{\getbuffer[scratchmarks]}

which uses a predefined counter \command{scratchmarks} and was typed as follows:

\typebuffer[scratchmarks]

We can also control other aspects of the filter, such as make it smaller
{\setupvisualcounter[scratchmarks][width=1pt,height=8pt,distance=2pt]\getbuffer[scratchmarks]}

or change the color palette

\midaligned{\setupvisualcounter[scratchmarks][palette=water-at-night]\getbuffer[scratchmarks]}




\section {The \command{scratchmarks} counter}

\section {The \command{markers} counter}

  n={\somenamedheadnumber{section}{current}},
  last={\somenamedheadnumber{section}{last}},
  text={\headnumber[section]},

\usevisualcounter{section}

\section {The \command{pulseline} counter}

\section {The \command{mayanumbers} counter}

\section[sec:new-counters]{How to define new counters}

\stoptext
